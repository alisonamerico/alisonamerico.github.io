{"categories":[{"link":"/pt-br/categories/testing/","name":"Testing","slug":"Testing"}],"pages":[],"posts":[{"link":"/pt-br/posts/entendendo-mock-e-magicmock-em-python/","text":" Este artigo foi escrito para qualquer pessoa entender (se teve algo que n√£o entendeu me fale, para que possa melhorar), mesmo quem ainda est√° come√ßando com testes em Python. Vamos explicar o que √© cada conceito, por que ele existe e quando usar, sempre com exemplos pr√°ticos e explica√ß√µes claras.\n1. O que √© Mock? (explica√ß√£o simples) Um Mock √© um objeto falso, criado apenas para testes, que finge ser outro objeto real.\nEle permite:\nSimular fun√ß√µes, m√©todos, classes e objetos inteiros Definir retornos e exce√ß√µes Registrar chamadas (quantidade, argumentos, ordem) Isolar a unidade de c√≥digo testada Em vez de usar:\num banco de dados real, uma API externa, um servi√ßo de e-mail, ou um sistema complexo, usamos um mock para simular esse comportamento.\nPor que isso √© importante? Porque em testes n√≥s queremos:\nvelocidade, previsibilidade, isolamento. Exemplo mental Imagine uma fun√ß√£o que envia e-mails:\nPYTHON Collapse Copy def send_email(to): print(\u0026#34;Enviando email\u0026#34;) Click to expand and view more Em um teste, voc√™ n√£o quer enviar e-mails de verdade. Ent√£o voc√™ substitui essa fun√ß√£o por um mock.\nO mock:\nn√£o envia nada, mas registra se foi chamado, com quais argumentos, e quantas vezes. üëâ Por isso dizemos que o mock √© flex√≠vel: voc√™ define como ele deve se comportar.\nüëâ Qualquer atributo acessado em um Mock vira automaticamente outro Mock.\n2. O que √© MagicMock? MagicMock √© um tipo especial e subclasse de Mock.\nEle existe para simular objetos que usam m√©todos m√°gicos do Python.\nO que s√£o m√©todos m√°gicos? S√£o m√©todos que:\ncome√ßam e terminam com __ o Python chama automaticamente Exemplos comuns:\n__len__ ‚Üí chamado quando usamos len(obj) __iter__ ‚Üí usado em for __getitem__ ‚Üí usado com obj[x] __contains__ ‚Üí usado com in __str__ ‚Üí usado com print(obj) Esses m√©todos n√£o s√£o chamados diretamente, mas pelo pr√≥prio Python.\nPor que MagicMock existe? O Mock normal n√£o lida bem com esses m√©todos. O MagicMock j√° vem preparado para isso.\n3. Mock ‚â† Stub ‚â† Fake (diferen√ßas importantes) Stub Um stub apenas retorna valores fixos.\nPYTHON Collapse Copy def get_user_stub(): return {\u0026#34;id\u0026#34;: 1} Click to expand and view more Fake Um fake tem uma implementa√ß√£o simples, mas funcional.\nPYTHON Collapse Copy class FakeEmailService: def __init__(self): self.sent = [] def send(self, to): self.sent.append(to) Click to expand and view more Mock Um mock registra chamadas e valida intera√ß√µes.\nPYTHON Collapse Copy from unittest.mock import Mock email = Mock() email.send(\u0026#34;a@test.com\u0026#34;) email.send.assert_called_once_with(\u0026#34;a@test.com\u0026#34;) Click to expand and view more 4. Principais atributos e m√©todos return_value Define o valor retornado pelo mock.\nPYTHON Collapse Copy mock.func.return_value = 10 Click to expand and view more side_effect Permite exce√ß√µes, fun√ß√µes ou m√∫ltiplos retornos.\nPYTHON Collapse Copy mock.func.side_effect = Exception(\u0026#34;Erro\u0026#34;) Click to expand and view more called / call_count Indicam se e quantas vezes foi chamado.\nPYTHON Collapse Copy assert mock.func.called assert mock.func.call_count == 1 Click to expand and view more call_args / call_args_list Mostram os argumentos usados.\nPYTHON Collapse Copy mock.func(1) mock.func(2) assert mock.func.call_args_list == [((1,),), ((2,),)] Click to expand and view more 5. patch ‚Äî substituindo depend√™ncias Use patch para trocar depend√™ncias reais por mocks temporariamente.\nA regra de ouro:\nVoc√™ deve patchar onde o objeto √© USADO, n√£o onde √© DEFINIDO.\nPYTHON Collapse Copy # app/services.py from app.email import send_email def notify(user): send_email(user.email) Click to expand and view more PYTHON Collapse Copy with patch(\u0026#34;app.services.send_email\u0026#34;) as mock_send: notify(user) Click to expand and view more ‚ùå ERRADO:\nPYTHON Collapse Copy patch(\u0026#34;app.email.send_email\u0026#34;) Click to expand and view more 6. spec e autospec Use para evitar erros silenciosos e garantir assinatura correta.\nspec Restringe atributos v√°lidos.\nPYTHON Collapse Copy mock = Mock(spec=MyClass) Click to expand and view more autospec Restringe atributos e assinatura.\nPYTHON Collapse Copy @patch(\u0026#34;module.func\u0026#34;, autospec=True) def test(mock_func): ... Click to expand and view more ‚úÖ Evita erros silenciosos.\n7. Mock com l√≥gica ‚Üí use Fake Se o mock cont√©m l√≥gica complexa, transforme-o em um fake.\n8. Problemas comuns e como resolver ‚ùå Mock n√£o funciona ‚û°Ô∏è Patch no lugar errado\n‚ùå Teste passa mas quebra em produ√ß√£o ‚û°Ô∏è Falta de autospec\n‚ùå Teste dif√≠cil de entender ‚û°Ô∏è Mocks demais\n‚ùå Mock com l√≥gica ‚û°Ô∏è Extraia para fake\n9. Quando usar (e quando N√ÉO usar) Use mocks quando: H√° chamadas HTTP H√° acesso a banco de dados H√° leitura/escrita de arquivos H√° servi√ßos externos H√° depend√™ncias dif√≠ceis de reproduzir N√ÉO use mocks quando: Voc√™ est√° testando l√≥gica pura O teste vira uma c√≥pia da implementa√ß√£o O mock come√ßa a ter l√≥gica pr√≥pria Regra pr√°tica: mock depend√™ncias, n√£o regras de neg√≥cio.\n10. Boas pr√°ticas reais Use autospec=True Mock menos, teste mais comportamento Nomeie bem seus mocks Um teste, um cen√°rio 11. Anti‚Äëpadr√µes üö´ Mockar m√©todo privado\nüö´ Mockar l√≥gica de dom√≠nio\nüö´ Testar apenas chamadas\nüö´ Mocks aninhados em excesso\n12. Checklist mental Antes de criar um mock:\nIsso √© uma depend√™ncia externa? Esse teste precisa mesmo disso? Um fake seria mais simples? Estou testando comportamento ou implementa√ß√£o? Refer√™ncias https://docs.python.org/3/library/unittest.mock.html ","title":"Entendendo Mock e MagicMock em Python"}],"tags":[{"link":"/pt-br/tags/mock/","name":"Mock","slug":"Mock"},{"link":"/pt-br/tags/python/","name":"Python","slug":"Python"},{"link":"/pt-br/tags/tests/","name":"Tests","slug":"Tests"},{"link":"/pt-br/tags/unittest/","name":"Unittest","slug":"Unittest"}]}